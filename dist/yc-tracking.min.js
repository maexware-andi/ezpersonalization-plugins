/*! yc-tracking - v0.9.0 - 2015-04-20 - Soprex */
(function(){function t(t){"use strict";var e=function(){var t=n,e="//event.yoochoose.net/api/"+t,c="//reco.yoochoose.net/ebl/"+t,a=30,o="YCStore",i=function(){var t="yc_localStorageTest";try{return r.localStorage.setItem(t,t),r.localStorage.removeItem(t),!0}catch(e){return!1}},s=function(){return i()?JSON.parse(r.localStorage.getItem(o)):null},l=function(t){if(!i())throw"Local storage not supported!";r.localStorage.setItem(o,JSON.stringify(t))},u=function(){var t=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},d=function(t){var e=s(),n=new Date;return n.setMinutes(n.getMinutes()+a),t||(t=e&&e.expires>(new Date).getTime()?e.userId:u()),l({userId:t,expires:n.getTime()}),t},m=function(t){var e,n="YCCookie",c=r.document.cookie,o=new Date,i=c.indexOf(" "+n+"=");return o.setMinutes(o.getMinutes()+a),t||(-1===i&&(i=c.indexOf(n+"=")),-1===i?t=u():(i=c.indexOf("=",i)+1,e=c.indexOf(";",i),-1===e&&(e=c.length),t=decodeURI(c.substring(i,e)))),r.document.cookie=n+"="+encodeURI(t)+"; expires="+o.toUTCString()+"; path=/",t},p=function(t){return i()?d(t):m(t)},f=function(t){var n=new Image(1,1);n.src=e+t};return this.resetUser=function(){return p(u())},this.getUserId=function(){return p()},this.trackClick=function(t,e,n,c){var a="/click/"+p()+"/"+t+"/"+e;return a+="?categorypath="+(n?encodeURIComponent(n):""),a+="&lang="+c,f(a),this},this.trackRate=function(t,e,n,c){var a="/rate/"+p()+"/"+t+"/"+e+"?rating="+n+"&lang="+c;return f(a),this},this.trackBasket=function(t,e,n,c){var a="/basket/"+p()+"/"+t+"/"+e;return a+="?categorypath="+(n?encodeURIComponent(n):""),a+="&lang="+c,f(a),this},this.trackBuy=function(t,e,n,c,a,r){var o="/buy/"+p()+"/"+t+"/"+e+"?fullprice="+(c+"").replace(",",".")+a+"&quantity="+n+"&lang="+r;return f(o),this},this.trackLogin=function(t){var e=p();return t&&e!==t&&(f("/login/"+e+"/"+encodeURIComponent(t)),p(t,!0)),this},this.trackRendered=function(t,e){var n="/rendered/"+p()+"/"+t+"/";return Array.isArray(e)||(e=[e]),f(n+e.join(",")),this},this.trackClickRecommended=function(t,e,n){var c="/clickrecommended/"+p()+"/"+t+"/"+e+"?scenario="+encodeURIComponent(n);return f(c),this},this.trackConsume=function(t,e,n){return f("/consume/"+p()+"/"+t+"/"+e+(n?"?percentage="+n:"")),this},this.trackBlacklist=function(t,e){var n="/blacklist/"+p()+"/"+t+"/"+e;return f(n),this},this.fetchRecommendedProducts=function(t,e,n,a,r,o){var i=document.createElement("script"),s=c+"/"+p()+"/"+e+".jsonp?numrecs="+n+"&outputtypeid="+t+"&jsonpcallback="+o;return s+="&contextitems="+(a?encodeURIComponent(a):""),s+="&categorypath="+(r?encodeURIComponent(r):""),i.src=s,document.getElementsByTagName("head")[0].appendChild(i),this},this},c={validateInt:function(t,e){var n=/^-?\d+$/.test(t);if(!n&&e)throw"Param is not valid. Expected integer.";return n},validateFloat:function(t,e){var n=/^-?\d*(\.\d*)?$/.test(t);if(!n&&e)throw"Param is not valid. Expected number.";return n}};t.YcTracking=new e,t.YcValidator=c}function e(t){"use strict";function e(){var t,e,n=document.getElementsByClassName("breadcrumbs"),c="";if(n)for(t=n[0].children[0].children,e=0;t.length>e;e++)-1!==t[e].className.indexOf("category")&&(c+=t[e].children[0].text+"/");return c}function n(){var t=document.getElementById("product_addtocart_form"),n=window.yc_config_object?window.yc_config_object:null,c=n?n.itemType:null,a=n?n.language:null,r=n?n.articleId:null,o="",i=document.getElementById("review-form");t&&(r||t.product&&(r=t.product.value),o=e()),r&&(u.trackClick(c,r,o,a),i&&(i.onsubmit=function(){var t=function(t,e){for(var n=0;t.length>n;n++)if(t[n].checked)return parseInt(t[n].value)-e;return 0},e=t(this.elements["ratings[1]"],0),n=t(this.elements["ratings[2]"],5),o=t(this.elements["ratings[3]"],10);0!==e&&0!==n&&0!==o&&(u.trackRate(c,r,20*e,a),u.trackRate(c,r,20*n,a),u.trackRate(c,r,20*o,a))}))}function a(){function t(t){if(window[t]){var n=window[t];window[t]=function(t){e(t),n(t)}}}function e(t){if(/checkout\/cart\/add/i.test(t)){var e,n,c=t.split("/");for(n=0;c.length>n;n++)if("product"===c[n]){e=parseInt(c[n+1]);break}e&&u.trackBasket(r,e,document.location.pathname,o)}}function n(t){var e=null,n=function(){this.product&&this.product.value&&u.trackBasket(r,this.product.value,document.location.pathname,o),e&&e.call(this)};t&&(e=t.submit,t.submit=n)}var c=document.getElementById("product_addtocart_form"),a=window.yc_config_object?window.yc_config_object:null,r=a?a.itemType:null,o=a?a.language:null;if(t("setLocation"),t("setPLocation"),window.addWItemToCart){var i=window.addWItemToCart;window.addWItemToCart=function(t){u.trackBasket(r,t,document.location.pathname,o),i(t)}}if(window.addAllWItemsToCart){var s=window.addAllWItemsToCart;window.addAllWItemsToCart=function(){var t,e,n;if(s(),e=document.getElementById("qty"),e&&(t=JSON.parse(e.value)))for(n=0;t.length>n;n++)t[n]&&u.trackBasket(r,n,document.location.pathname,o)}}c&&n(c),window.productAddToCartForm&&n(window.productAddToCartForm.form)}function r(){var t,e,n,c=window.yc_config_object?window.yc_config_object:null,a=c?c.itemType:null,r=c?c.language:null;if(c.orderData)for(t=c.orderData,n=0;t.length>n;n++)e=t[n],e&&u.trackBuy(a,parseInt(e.id),parseInt(e.quantity),parseFloat(e.price),e.currency,r)}function o(){var t,e=document.getElementById("header-account"),n=e?e.getElementsByTagName("a"):null;if(n)for(t=0;n.length>t;t++)/customer\/account\/logout/i.test(n[t].href)&&(n[t].onclick=function(){u.resetUser()})}function i(t){return function(e){var n,c,a=[],r=location.origin+Mage.Cookies.path+"/yoochoose/products/index/?productIds=";return e.hasOwnProperty("recommendationResponseList")?(e.recommendationResponseList.forEach(function(t){a.push(t.itemId)}),r+=a.join(),n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(c=JSON.parse(n.responseText),l(t,c))},n.open("GET",r,!0),n.send(),void 0):(console.log(e),void 0)}}function s(){var t,n,c=window.yc_config_object?window.yc_config_object:null,a=c?c.itemType:null,r=c?c.boxes:null,o=c?c.currentPage:null,s=null;if("product"===o?s=e():"cart"===o&&(s=document.location.pathname),null!==r)for(var l=0;r.length>l;l++)r[l].display&&(t=d[r[l].id],n="YcTracking_jsonpCallback"+r[l].id,window[n]=i(r[l]),u.fetchRecommendedProducts(a,t.scenario,t.rows*t.columns,c.products,s,n))}function l(t,e){var n=new DOMParser,c=n.parseFromString(d[t.id].html_template,"text/xml"),a=c.firstChild,r=a.childNodes[1],o=r.getElementsByClassName("yc_title")[0],i=r.getElementsByClassName("yc_id")[0],s=r.getElementsByClassName("yc_price")[0],l=r.getElementsByClassName("yc_currency")[0],u=r.getElementsByTagName("img")[0],m=null;a.childNodes[0].innerHTML=t.title,a.removeChild(a.childNodes[1]),l.innerHTML=e.currency,e.products.forEach(function(t){i.innerHTML=t.entity_id,o.innerHTML=t.name,o.attributes.href.value=t.url_path,s.innerHTML=t.price,u.attributes.src.value=t.thumbnail,a.appendChild(r.cloneNode(!0))}),m=document.getElementsByClassName(d[t.id].target)[0],m.appendChild(a)}var u=t.YcTracking,d=c;window.onload=function(){var t=window.yc_config_object?window.yc_config_object:null,e=t?t.trackid:null;u.trackLogin(e),n(),a(),o(),r(),s()}}var n=904,c={related:{html_template:"<section class='yc_recommendations'><h3></h3><div><span class='yc_id'></span><img src='' /><a class='yc_title' href=''></a><span class='yc_price'></span><span class='yc_currency'></span></div></section>",target:"main",rows:2,columns:3,scenario:"cross-rate"},crosssaling:{html_template:"<section class='yc_recommendations'><h3></h3><div><span class='yc_id'></span><img src='' /><a class='yc_title' href=''></a><span class='yc_price'></span><span class='yc_currency'></span></div></section>",target:"main",rows:2,columns:3,scenario:"cross_sell"},personal:{html_template:"<section class='yc_recommendations'><h3></h3><div><span class='yc_id'></span><img src='' /><a class='yc_title' href=''></a><span class='yc_price'></span><span class='yc_currency'></span></div></section>",target:"main",rows:2,columns:3,scenario:"personalized"},upselling:{html_template:"<section class='yc_recommendations'><h3></h3><div><span class='yc_id'></span><img src='' /><a class='yc_title' href=''></a><span class='yc_price'></span><span class='yc_currency'></span></div></section>",target:"main",rows:2,columns:3,scenario:"ultimately_bought"},bestseller:{html_template:"<section class='yc_recommendations'><h3></h3><div><span class='yc_id'></span><img src='' /><a class='yc_title' href=''></a><span class='yc_price'></span><span class='yc_currency'></span></div></section>",target:"main",rows:2,columns:3,scenario:"landing_page"}},a=Function,r=new a("return this")(),o=function(n){return t(n),e(n),n.YcTracking};"function"==typeof define&&define.amd?define(function(){return o({})}):o(this)})(this);