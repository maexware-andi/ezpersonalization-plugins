<!DOCTYPE html>
<html>
<head>
    <link href="qunit/qunit.css" rel="stylesheet" type="text/css"/>
    <script src="qunit/qunit.js"></script>
    <script src="../vendor/jquery.js"></script>
    <!--
    This RequireJS script is patched to add an undef() method. This allows this test suite to clean up loaded modules after each test.
    Otherwise, it's not possible to successively load modules with the same name but different paths via multiple require.config() calls.

    Some code borrowed from: https://github.com/jrburke/requirejs/commit/c8a6636f08ca552cbff3843f27eab8825e33fab9
    -->
    <script src="../vendor/require-1.0.7+undef.js"></script>
    <script>

        function requireConfig(path_opts) {
            var paths = $.extend({
                ycTracking: '../dist/yc-tracking',
                ycTrackingMin: '../dist/yc-tracking.min'
            }, path_opts || {});

            require.config({
                paths: paths
            });
        }

        $(document).ready(function () {

            module('Loading with RequireJS', {
                teardown: function () {
                    $('head').find('script[data-requiremodule]').remove();
                    require.undef('ycTracking');
                }
            });

            asyncTest('Can load the minified version of yc-tracking', function () {
                requireConfig();

                require(['ycTrackingMin'], function (ycTracking) {
                    ok(ycTracking !== undefined);
                    start();
                });
            });

            asyncTest('Global scope is not polluted by yc-tracking', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    ok(window.YcTracking === undefined);
                    start();
                });
            });

            asyncTest('Cannot load debug methods from the minified version of yc-tracking', function () {
                requireConfig();

                require(['ycTrackingMin'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library.getUserId === undefined);
                    start();
                });
            });

            asyncTest('userId call', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library.getUserId() === library.getUserId());
                    start();
                });
            });

            asyncTest('userDetails call', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library.getUserId() === library.getUserDetails().userId);
                    start();
                });
            });

            asyncTest('_executeEventCall is private.', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library._executeEventCall === undefined);
                    start();
                });
            });

            asyncTest('customerId is private.', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library.customerId === undefined);
                    start();
                });
            });

            asyncTest('trackClick call', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library === library.trackClick(1, (Math.random() * 100) + 1));
                    start();
                });
            });

            asyncTest('trackRate call', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library === library.trackRate(1, (Math.random() * 100) + 1, (Math.random() * 100) + 1));
                    start();
                });
            });

            asyncTest('trackBasket call', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library === library.trackBasket(1, (Math.random() * 100) + 1, 'cat/subcat'));
                    start();
                });
            });

            asyncTest('trackBuy call', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library === library.trackBuy(1, (Math.random() * 100) + 1, (Math.random() * 10) + 1, Math.random() * 100, 'EUR'));
                    start();
                });
            });

            asyncTest('trackLogin call', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library === library.trackLogin((Math.random() * 100) + 1));
                    start();
                });
            });

            asyncTest('trackRendered call', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library === library.trackRendered(1, [(Math.random() * 100) + 1, (Math.random() * 100) + 1, (Math.random() * 100) + 1]));
                    start();
                });
            });

            asyncTest('trackClickRecommended call', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library === library.trackClickRecommended(1, (Math.random() * 100) + 1, 'SCENARIO with & chars'));
                    start();
                });
            });

            asyncTest('trackConsume call', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library === library.trackConsume(1, (Math.random() * 100) + 1));
                    start();
                });
            });

            asyncTest('trackBlacklist call', function () {
                requireConfig();

                require(['ycTracking'], function (ycTracking) {
                    var library = new ycTracking();
                    ok(library === library.trackBlacklist(1, (Math.random() * 100) + 1));
                    start();
                });
            });
        });
    </script>
</head>
<body>
    <h1 id="qunit-header">yc-tracking</h1>
    <h2 id="qunit-banner"></h2>
    <div id="qunit-testrunner-toolbar"></div>
    <h2 id="qunit-userAgent"></h2>
    <ol id="qunit-tests"></ol>
    <div id="qunit-fixture"></div>
</body>
</html>
